{"version":3,"file":"busy.component.js","sourceRoot":"","sources":["../../.tmp/busy/busy.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, OnDestroy, Input } from '@angular/core';\nimport { trigger, state, style, animate, transition, AnimationEvent } from '@angular/animations';\nimport { BusyService } from './busy.service';\nimport { Subscription } from 'rxjs/Rx';\n\n@Component({\n    selector: 'gst-busy',\n    styles: [\".ng2-busy { display: none; opacity: 0; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; text-align: center; z-index: 100000; background: rgba(0, 0, 0, 0.2); transition: all 0.5s ease-in-out; } \"],\n    template: \"<div class=\\\"ng2-busy\\\" [@getbusy]=\\\"state\\\" (@getbusy.start)=\\\"animation($event)\\\" (@getbusy.done)=\\\"animation($event)\\\" [style.display]=\\\"divStateHide ? 'none' : 'block'\\\" [style.opacity]=\\\"divStateHide ? 0 : 1\\\" > <ng-content></ng-content> </div>\",\n    animations: [\n        trigger('getbusy', [\n            state('show', style({\n                opacity: 1\n            })),\n            state('hide', style({\n                opacity: 0\n            })),\n            transition('* => *', animate('250ms ease-in-out')),\n        ])\n    ]\n})\nexport class BusyComponent implements OnInit, OnDestroy {\n\n    /**\n     * Set the minimum loader display time\n     */\n    @Input() private minTTL: number = 400;\n    private startCount: number = 0;\n    private firstStartTime: number = 0;\n    private busy: any;\n    private state: string = 'hide';\n    private divStateHide: boolean = true;\n    private subscription: Subscription;\n\n    constructor(private busyService: BusyService) {  }\n\n    public ngOnInit() {\n        this.createServiceSubscription();\n    }\n\n    public ngOnDestroy() {\n        this.subscription.unsubscribe();\n    }\n\n    public startBusy() {\n        this.state = 'show';\n        this.startCount++;\n        if (this.firstStartTime === 0) {\n            this.firstStartTime = Date.now();\n        }\n    }\n\n    public stopBusy() {\n        this.startCount--;\n        if (this.startCount <= 0) {\n            let now = Date.now();\n            if (now - this.firstStartTime >= this.minTTL) {\n                this.state = 'hide';\n                this.firstStartTime = 0;\n            } else {\n                setTimeout(() => {\n                    this.stopBusy();\n                }, this.minTTL - (now - this.firstStartTime));\n            }\n        }\n    }\n\n    public animation(event: AnimationEvent) {\n        if (event.phaseName === 'done' && event.toState === 'hide') {\n            this.divStateHide = true;\n        }\n        if (event.phaseName === 'start' && event.toState === 'show') {\n            this.divStateHide = false;\n        }\n    }\n\n    private createServiceSubscription() {\n        this.subscription = this.busyService.busyObservable.subscribe((show) => {\n            if (show) {\n                this.startBusy();\n            } else {\n                this.stopBusy();\n            }\n        });\n    }\n}\n"]}